


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../_static/js/jquery.min.js"></script>	
	  <script type="text/javascript" src="../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../_static/js/common-ui-all.min.js"></script>		
    <script type="text/javascript" src="../_static/js/header-footer.min.js"></script>	
    <script type="text/javascript" src="../_static/js/jquery-ui.min.js"></script>	
    <script type="text/javascript" src="../_static/js/CoveoJsSearch.Lazy.min.js"></script>	
    <script type="text/javascript" src="../_static/js/linkid.js"></script>		
    <script type="text/javascript" src="../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search" 
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a> 
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search" 
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Vitis Vision Library
          

          
          </a>

          
            
            
              <div class="version">
                2021.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Vitis Vision Library User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html#getting-started-with-vitis-vision">Getting Started with Vitis Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html#getting-started-with-hls">Getting Started with HLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html#design-examples-using-vitis-vision-library">Design Examples Using Vitis Vision Library</a></li>
</ul>
<p class="caption"><span class="caption-text">Vitis Vision AIE Library User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview-aie.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview-aie.html#getting-started-with-vitis-vision-aie">Getting Started with Vitis Vision AIE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview-aie.html#design-example-using-vitis-vision-aie-library">Design example Using Vitis Vision AIE Library</a></li>
</ul>
<p class="caption"><span class="caption-text">Vitis Vision Library API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api-reference.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-reference.html#xf-cv-mat-image-container-class">xf::cv::Mat Image Container Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-reference.html#vitis-vision-library-functions">Vitis Vision Library Functions</a></li>
</ul>
<p class="caption"><span class="caption-text">Vitis Vision AIE Library API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api-reference-aie.html">xfcvDataMovers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-reference-aie.html#vitis-vision-aie-library-functions-api-list-with-performance-estimates">Vitis Vision AIE Library Functions API list with performance estimates</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmark</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Benchmark.html">Benchmark</a></li>
</ul>
<p class="caption"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../releasenotesxfopencv.html">Release notes</a></li>
</ul>

            
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../_sources/include/design-example-aie.rst.txt"
						rel="nofollow">Show Source</a></li>						
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Vitis Vision Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Design example Using Vitis Vision AIE Library</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/include/design-example-aie.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="design-example-using-vitis-vision-aie-library">
<h1>Design example Using Vitis Vision AIE Library<a class="headerlink" href="#design-example-using-vitis-vision-aie-library" title="Permalink to this headline">¶</a></h1>
<p>Following example application performs a 2D filtering operation over a gray scale image. The
convolution kernel is a 3x3 window with floating point representation. The coefficients are
converted to fixed point representation before being passed to AIE core for computation. The
results are cross validated against OpenCV reference implementation. The example illustrates
both PLIO and GMIO based data transfers.</p>
<div class="section" id="adf-graph">
<h2>ADF Graph<a class="headerlink" href="#adf-graph" title="Permalink to this headline">¶</a></h2>
<p>An AI Engine program consists of a data flow graph specification written in C++. The dataflow graph consists of top level ports,
kernel instances and connectivity. a graph.h file is created which includes the header adf.h.</p>
<p>For more details on data flow graph creation, please refer <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/ai_engine_programming.html">AI Engine Programming</a> .</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;kernels.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;adf.h&gt;</span><span class="cp"></span>

<span class="n">using</span> <span class="n">namespace</span> <span class="n">adf</span><span class="p">;</span>

<span class="n">class</span> <span class="nl">myGraph</span> <span class="p">:</span> <span class="n">public</span> <span class="n">adf</span><span class="o">::</span><span class="n">graph</span> <span class="p">{</span>
   <span class="nl">public</span><span class="p">:</span>
    <span class="n">kernel</span> <span class="n">k1</span><span class="p">;</span>
    <span class="n">port</span><span class="o">&lt;</span><span class="n">input</span><span class="o">&gt;</span> <span class="n">inptr</span><span class="p">;</span>
    <span class="n">port</span><span class="o">&lt;</span><span class="n">output</span><span class="o">&gt;</span> <span class="n">outptr</span><span class="p">;</span>
    <span class="n">port</span><span class="o">&lt;</span><span class="n">input</span><span class="o">&gt;</span> <span class="n">kernelCoefficients</span><span class="p">;</span>

  <span class="n">myGraph</span><span class="p">()</span> <span class="p">{</span>
     <span class="n">k1</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="n">filter2D</span><span class="p">);</span>
     <span class="n">adf</span><span class="o">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">window</span><span class="o">&lt;</span><span class="n">TILE_WINDOW_SIZE</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">inptr</span><span class="p">,</span> <span class="n">k1</span><span class="p">.</span><span class="n">in</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
     <span class="n">adf</span><span class="o">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">parameter</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kernelCoefficients</span><span class="p">,</span> <span class="n">async</span><span class="p">(</span><span class="n">k1</span><span class="p">.</span><span class="n">in</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
     <span class="n">adf</span><span class="o">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">window</span><span class="o">&lt;</span><span class="n">TILE_WINDOW_SIZE</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">k1</span><span class="p">.</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">outptr</span><span class="p">);</span>

     <span class="n">source</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span> <span class="o">=</span> <span class="s">&quot;xf_filter2d.cc&quot;</span><span class="p">;</span>
     <span class="c1">// Initial mapping</span>
     <span class="n">runtime</span><span class="o">&lt;</span><span class="n">ratio</span><span class="o">&gt;</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="platform-ports">
<h2>Platform Ports<a class="headerlink" href="#platform-ports" title="Permalink to this headline">¶</a></h2>
<p>A top-level application file graph.cpp is created which contains an instance of the graph class and is connected to a simulation platform. A virtual platform specification helps to connect the data flow graph written with external I/O
mechanisms specific to the chosen target for testing or eventual deployment.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;graph.h&quot;</span><span class="cp"></span>

<span class="c1">// Virtual platform ports</span>
<span class="n">PLIO</span><span class="o">*</span> <span class="n">in1</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s">&quot;DataIn1&quot;</span><span class="p">,</span> <span class="n">adf</span><span class="o">::</span><span class="n">plio_64_bits</span><span class="p">,</span> <span class="s">&quot;data/input.txt&quot;</span><span class="p">);</span>
<span class="n">PLIO</span><span class="o">*</span> <span class="n">out1</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s">&quot;DataOut1&quot;</span><span class="p">,</span> <span class="n">adf</span><span class="o">::</span><span class="n">plio_64_bits</span><span class="p">,</span> <span class="s">&quot;data/output.txt&quot;</span><span class="p">);</span>
<span class="n">simulation</span><span class="o">::</span><span class="n">platform</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="n">platform</span><span class="p">(</span><span class="n">in1</span><span class="p">,</span> <span class="n">out1</span><span class="p">);</span>

<span class="c1">// Graph object</span>
<span class="n">myGraph</span> <span class="n">filter_graph</span><span class="p">;</span>

<span class="c1">// Virtual platform connectivity</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net0</span><span class="p">(</span><span class="n">platform</span><span class="p">.</span><span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filter_graph</span><span class="p">.</span><span class="n">inptr</span><span class="p">);</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net1</span><span class="p">(</span><span class="n">filter_graph</span><span class="p">.</span><span class="n">outptr</span><span class="p">,</span> <span class="n">platform</span><span class="p">.</span><span class="n">sink</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</div>
<ol class="arabic">
<li><p>PLIO</p>
<p>A PLIO port attribute is used to make external stream connections that cross the AI Engine to programmable logic (PL) boundary. PLIO attributes are used to specify the port name, port bit width and the input/output file names.
Note that when simulating PLIO with data files, the data should be organized to accomodate both the width of the PL block as well as the data type of connecting port on the AI Engine block.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Platform ports</span>
<span class="n">PLIO</span><span class="o">*</span> <span class="n">in1</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s">&quot;DataIn1&quot;</span><span class="p">,</span> <span class="n">adf</span><span class="o">::</span><span class="n">plio_64_bits</span><span class="p">,</span> <span class="s">&quot;data/input.txt&quot;</span><span class="p">);</span>
<span class="n">PLIO</span><span class="o">*</span> <span class="n">out1</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s">&quot;DataOut1&quot;</span><span class="p">,</span> <span class="n">adf</span><span class="o">::</span><span class="n">plio_64_bits</span><span class="p">,</span> <span class="s">&quot;data/output.txt&quot;</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>GMIO</p>
<p>A GMIO port attribute is used to make external memory-mapped connections to or from the global memory. These connections are made between an AI Engine graph and the logical global memory ports of a hardware platform design.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//Platform ports</span>
<span class="n">GMIO</span> <span class="nf">gmioIn1</span><span class="p">(</span><span class="s">&quot;gmioIn1&quot;</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
<span class="n">GMIO</span> <span class="nf">gmioOut</span><span class="p">(</span><span class="s">&quot;gmioOut&quot;</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>

<span class="c1">//Virtual platform</span>
<span class="n">simulation</span><span class="o">::</span><span class="n">platform</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="n">platform</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gmioIn1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gmioOut</span><span class="p">);</span>

<span class="c1">//Graph object</span>
<span class="n">myGraph</span> <span class="n">filter_graph</span><span class="p">;</span>

<span class="c1">//Platform ports</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net0</span><span class="p">(</span><span class="n">platform</span><span class="p">.</span><span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filter_graph</span><span class="p">.</span><span class="n">in1</span><span class="p">);</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net1</span><span class="p">(</span><span class="n">filter_graph</span><span class="p">.</span><span class="n">out1</span><span class="p">,</span> <span class="n">platform</span><span class="p">.</span><span class="n">sink</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="host-code">
<h2>Host code<a class="headerlink" href="#host-code" title="Permalink to this headline">¶</a></h2>
<p>Host code ‘host.cpp’ will be running on the host processor which conatins the code to initialize and run the datamovers and the ADF graph. XRT APIs are
used to create the required buffers in the device memory.</p>
<p>First a golden reference image is generated using OpenCV</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">run_opencv_ref</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span> <span class="n">srcImageR</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span> <span class="n">dstRefImage</span><span class="p">,</span> <span class="kt">float</span> <span class="n">coeff</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span> <span class="p">{</span>
<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">tmpImage</span><span class="p">;</span>
<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">kernel</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">CV_32F</span><span class="p">,</span> <span class="n">coeff</span><span class="p">);</span>
<span class="n">cv</span><span class="o">::</span><span class="n">filter2D</span><span class="p">(</span><span class="n">srcImageR</span><span class="p">,</span> <span class="n">dstRefImage</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">BORDER_REPLICATE</span><span class="p">);</span>
<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then, xclbin is loaded on the device and the device handles are created</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">xF</span><span class="o">::</span><span class="n">deviceInit</span><span class="p">(</span><span class="n">xclBinName</span><span class="p">);</span>
</pre></div>
</div>
<p>Buffers for input and output data are created using the XRT APIs and data from input CV::Mat is copied to the XRT buffer.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="o">*</span> <span class="n">srcData</span> <span class="o">=</span> <span class="n">nullptr</span><span class="p">;</span>
<span class="n">xrtBufferHandle</span> <span class="n">src_hndl</span> <span class="o">=</span> <span class="n">xrtBOAlloc</span><span class="p">(</span><span class="n">xF</span><span class="o">::</span><span class="n">gpDhdl</span><span class="p">,</span> <span class="p">(</span><span class="n">srcImageR</span><span class="p">.</span><span class="n">total</span><span class="p">()</span> <span class="o">*</span> <span class="n">srcImageR</span><span class="p">.</span><span class="n">elemSize</span><span class="p">()),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">srcData</span> <span class="o">=</span> <span class="n">xrtBOMap</span><span class="p">(</span><span class="n">src_hndl</span><span class="p">);</span>
<span class="n">memcpy</span><span class="p">(</span><span class="n">srcData</span><span class="p">,</span> <span class="n">srcImageR</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">srcImageR</span><span class="p">.</span><span class="n">total</span><span class="p">()</span> <span class="o">*</span> <span class="n">srcImageR</span><span class="p">.</span><span class="n">elemSize</span><span class="p">()));</span>

<span class="c1">// Allocate output buffer</span>
<span class="kt">void</span><span class="o">*</span> <span class="n">dstData</span> <span class="o">=</span> <span class="n">nullptr</span><span class="p">;</span>
<span class="n">xrtBufferHandle</span> <span class="n">dst_hndl</span> <span class="o">=</span> <span class="n">xrtBOAlloc</span><span class="p">(</span><span class="n">xF</span><span class="o">::</span><span class="n">gpDhdl</span><span class="p">,</span> <span class="p">(</span><span class="n">op_height</span> <span class="o">*</span> <span class="n">op_width</span> <span class="o">*</span> <span class="n">srcImageR</span><span class="p">.</span><span class="n">elemSize</span><span class="p">()),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">dstData</span> <span class="o">=</span> <span class="n">xrtBOMap</span><span class="p">(</span><span class="n">dst_hndl</span><span class="p">);</span>
<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">dst</span><span class="p">(</span><span class="n">op_height</span><span class="p">,</span> <span class="n">op_width</span><span class="p">,</span> <span class="n">srcImageR</span><span class="p">.</span><span class="n">type</span><span class="p">(),</span> <span class="n">dstData</span><span class="p">);</span>
</pre></div>
</div>
<p>xfcvDataMovers objects tiler and stitcher are created. For more details on xfcvDataMovers refer <a class="reference internal" href="../overview-aie.html#xfcvdatamovers-aie"><span class="std std-ref">xfcvDataMovers</span></a></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">xF</span><span class="o">::</span><span class="n">xfcvDataMovers</span><span class="o">&lt;</span><span class="n">xF</span><span class="o">::</span><span class="n">TILER</span><span class="p">,</span> <span class="kt">int16_t</span><span class="p">,</span> <span class="n">MAX_TILE_HEIGHT</span><span class="p">,</span> <span class="n">MAX_TILE_WIDTH</span><span class="p">,</span> <span class="n">VECTORIZATION_FACTOR</span><span class="o">&gt;</span> <span class="n">tiler</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">xF</span><span class="o">::</span><span class="n">xfcvDataMovers</span><span class="o">&lt;</span><span class="n">xF</span><span class="o">::</span><span class="n">STITCHER</span><span class="p">,</span> <span class="kt">int16_t</span><span class="p">,</span> <span class="n">MAX_TILE_HEIGHT</span><span class="p">,</span> <span class="n">MAX_TILE_WIDTH</span><span class="p">,</span> <span class="n">VECTORIZATION_FACTOR</span><span class="o">&gt;</span> <span class="n">stitcher</span><span class="p">;</span>
</pre></div>
</div>
<p>ADF graph is initialized and the filter coefficients are updated.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">filter_graph</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
<span class="n">filter_graph</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">filter_graph</span><span class="p">.</span><span class="n">kernelCoefficients</span><span class="p">,</span> <span class="n">float2fixed_coeff</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kData</span><span class="p">).</span><span class="n">data</span><span class="p">(),</span> <span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
<p>Metadata containing the tile information is generated.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">tiler</span><span class="p">.</span><span class="n">compute_metadata</span><span class="p">(</span><span class="n">srcImageR</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
</pre></div>
</div>
<p>The data transfer to AIE via datamovers is initiated along with graph run and further execution waits till the data transfer is complete.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">tiles_sz</span> <span class="o">=</span> <span class="n">tiler</span><span class="p">.</span><span class="n">host2aie_nb</span><span class="p">(</span><span class="n">src_hndl</span><span class="p">,</span> <span class="n">srcImageR</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="n">stitcher</span><span class="p">.</span><span class="n">aie2host_nb</span><span class="p">(</span><span class="n">dst_hndl</span><span class="p">,</span> <span class="n">dst</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">tiles_sz</span><span class="p">);</span>

<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Graph run(&quot;</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">tiles_sz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">tiles_sz</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>

<span class="n">filter_graph</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tiles_sz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">tiles_sz</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

<span class="n">filter_graph</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span>
<span class="n">tiler</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span>
<span class="n">stitcher</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="makefile">
<span id="aie-makefile"></span><h2>Makefile<a class="headerlink" href="#makefile" title="Permalink to this headline">¶</a></h2>
<p>Run ‘make help’ to get list of commands and flows supported. Running below command will initiate a hardware build.</p>
<p>make all TARGET=hw DEVICE=&lt;FPGA platform&gt;</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->

</footer>

        </div>
      </div>
	  
	  
	  <!-- Sphinx Page Footer block -->
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on August 10, 2021.
      </span>

    </p>
  </div>	  
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
  

  
  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2021, Xilinx
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}
			
			underscoreSetup();
		</script>
	</body>
</html>